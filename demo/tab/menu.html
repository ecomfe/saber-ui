<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Tab - Saber UI Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="stylesheet" href="../button/button.css">
    <link rel="stylesheet" href="tab.css">
    <link rel="stylesheet" href="demo.css">
    <script src="http://s1.bdstatic.com/r/www/cache/ecom/esl/1-6-10/esl.js"></script> 
    <script>
    require.config({
        'packages': [
            {
                'name': 'saber-dom',
                'location': '../dep/saber-dom/0.4.0/src',
                'main': 'main'
            },
            {
                'name': 'saber-string',
                'location': '../dep/saber-string/0.3.0/src',
                'main': 'main'
            },
            {
                'name': 'saber-lang',
                'location': '../dep/saber-lang/0.3.1/src',
                'main': 'main'
            },
            {
                'name': 'saber-emitter',
                'location': '../dep/saber-emitter/0.5.0/src',
                'main': 'emitter'
            },
            {
                'name': 'saber-scroll',
                'location': '../dep/saber-scroll/0.1.2/src',
                'main': 'main'
            },
            {
                'name': 'saber-run',
                'location': '../dep/saber-run/0.2.0/src',
                'main': 'main'
            },
            {
                'name': 'saber-promise',
                'location': '../dep/saber-promise/0.1.2/src',
                'main': 'promise'
            },
            {
                'name': 'saber-tap',
                'location': '../dep/saber-tap/0.1.2/src',
                'main': 'tap'
            },
            {
                'name': 'saber-ui',
                'location': '../../src',
                'main': 'main'
            }
        ]
    });
    </script>

</head>

<body>
    <header>Tab</header>

    <div class="container">
        <h2>静态化构建</h2>
        <div id="wrapper3" class="wrapper">
            <div class="loading">初始化中...</div>
            
            <h3>滚动导航</h3>
            <div data-ui="type:Tab;scroll:true;">
                <ul data-role="navigator">
                    <li>教育</li>
                    <li>动漫</li>
                    <li>健康</li>
                    <li>生活</li>
                    <li>游戏</li>
                    <li>美女</li>
                    <li>汽车</li>
                    <li>新闻</li>
                    <li>话题</li>
                    <li>焦点</li>
                    <li>贴吧</li>
                    <li>ECOM</li>
                    <li>中国</li>
                    <li>美国</li>
                    <li>北京</li>
                    <li>百度</li>
                    <li>海辉</li>
                    <li>文思</li>
                    <li>大厦</li>
                </ul>
            </div>
            
            <h3>复合列表</h3>
            <div data-ui="type:Button;id:menu;">分类</div>
            <div class="dropmenu dropmenu-hidden">
                <div class="menu">
                    <div data-ui="type:Tab;id:list;orientation:vertical;scroll:true;" data-ui-plugin-scroll="horizontal:false;">
                        <ul data-role="navigator">
                            <li data-for="a1">教育</li>
                            <li data-for="a2">动漫</li>
                            <li data-for="a3">健康</li>
                            <li data-for="a4">生活</li>
                            <li data-for="a5">游戏</li>
                            <li data-for="a6">美女</li>
                            <li data-for="a7">汽车</li>
                            <li data-for="a8">新闻</li>
                            <li data-for="a9">话题</li>
                            <li data-for="a10">焦点</li>
                            <li data-for="a11">贴吧</li>
                            <li data-for="a12">ECOM</li>
                            <li data-for="a13">中国</li>
                            <li data-for="a14">美国</li>
                            <li data-for="a15">北京</li>
                            <li data-for="a16">百度</li>
                            <li>海辉</li>
                            <li>文思</li>
                            <li data-for="a17">大厦</li>
                        </ul>
                    </div>
                </div>
                <div class="panel">
                    <div>
                        <div id="a1" class="ui-tab-panel">教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx教育xxxxxxSFSDGEEGEHEHRHHEHxxxxxxxxxx</div>
                        <div id="a2" class="ui-tab-panel">动漫xxxxxxxxxxxxxxxx</div>
                        <div id="a3" class="ui-tab-panel">健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx健康xxxxxxxxxxxxxxxx</div>
                        <div id="a4" class="ui-tab-panel">生活xxxxxxxxxxxxxxxx</div>
                        <div id="a5" class="ui-tab-panel">游戏xxxxxxxxxxxxxxxx</div>
                        <div id="a6" class="ui-tab-panel">美女xxxxxxxxxxxxxxxx</div>
                        <div id="a7" class="ui-tab-panel">汽车xxxxxxxxxxxxxxxx</div>
                        <div id="a8" class="ui-tab-panel">新闻xxxxxxxxxxxxxxxx</div>
                        <div id="a9" class="ui-tab-panel">话题xxxxxxxxxxxxxxxx</div>
                        <div id="a10" class="ui-tab-panel">焦点xxxxxxxxxxxxxxxx</div>
                        <div id="a11" class="ui-tab-panel">贴吧xxxxxxxxxxxxxxxx</div>
                        <div id="a12" class="ui-tab-panel">ECOMxxxxxxxxxxxxxxxx</div>
                        <div id="a13" class="ui-tab-panel">中国xxxxxxxxxxxxxxxx</div>
                        <div id="a14" class="ui-tab-panel">美国xxxxxxxxxxxxxxxx</div>
                        <div id="a15" class="ui-tab-panel">北京xxxxxxxxxxxxxxxx</div>
                        <div id="a16" class="ui-tab-panel">百度xxxxxxxxxxxxxxxx</div>
                        <div id="a17" class="ui-tab-panel">大厦xxxxxxxxxxxxxxxx</div>
                    </div>
                </div>
            </div>
        </div>

        <h2>动态化创建</h2>
        <div id="wrapper4" class="wrapper"></div>
    </div>

    <script>
    require(
        [
            'saber-tap',
            'saber-dom',
            'saber-scroll',
            'saber-scroll/plugin/scrollbar',
            'saber-ui',
            'saber-ui/Button',
            'saber-ui/Tab',
            'saber-ui/plugin/TabScroll'
        ],
        function( Tap, dom, Scroll, ScrollBar, ui, Button, Tab ) {
            var $ = dom.query;
            var $$ = dom.queryAll;
            var wrapper1 = $( '#wrapper3' );
            var wrapper2 = $( '#wrapper4' );
            var dropmenu = $( '.dropmenu' );
            var initSuccess = function () {
                setTimeout(
                    function () {
                        $( '.loading' ).style.display = 'none';
                    },
                    500
                );
            };

            // 300ms 点击延迟修复
            Tap.mixin( $( '.container' ) );



            // 静态化
            ui.init( wrapper1, { success: initSuccess } );
            
            var menu = ui.get( 'menu' );
            var tab = ui.get( 'list' );
            var panelScroll;

            menu.onclick = function () {
                var cls = 'dropmenu-hidden';
                var isHide = dom.hasClass( dropmenu, cls );

                dom[
                    isHide ? 'removeClass' : 'addClass'
                ]( dropmenu, cls );

                if ( isHide && !panelScroll) {
                    panelScroll = Scroll(
                        $( '.panel' ),
                        { scrollbar: true }
                    );

                    // TODO:
                    // 默认父容器隐藏状态，scroll无法计算
                    // 这里借助panel的一次性初始化时机一起重绘下
                    tab.get( 'plugins' )[ 'TabScroll' ].repaint();
                }
            };

            tab.on( 'change', function () {
                panelScroll && panelScroll.repaint();
            });
            tab.on( 'afterdispose', function () {
                panelScroll && panelScroll.destroy();
                panelScroll = null;
            });






            // 动态化
            wrapper2.innerHTML = '<h3>滚动导航</h3><h3>复合面板</h3>';

            // navigator demo
            var navigatorMenu = new Tab({
                tabs: tab.get( 'tabs' ).map(function ( tab ) {
                    return { title: tab.title };
                }),
                activeIndex: 2,
                scroll: true, // 启用拖动插件
                plugins: {
                    // 拖动插件配置
                    scroll: {
                        horizontal: false // 禁止横向滚动
                    }
                }
            });
            navigatorMenu.insertBefore( $$( 'h3', wrapper2)[ 1 ] );

            // dropmenu
            var mymenu = new Button({ content: '分类' });
            mymenu.appendTo( wrapper2 );
            mymenu.onclick = function () {
                if ( !mydropmenu ) {
                    initDropMenu();
                }

                var cls = 'dropmenu-hidden';
                var isHide = dom.hasClass( mydropmenu, cls );

                dom[
                    isHide ? 'removeClass' : 'addClass'
                ]( mydropmenu, cls );

                if ( isHide && !mytab ) {
                    initDropMenuTab();
                }

                if ( isHide && !mypanelScroll ) {
                    initDropMenuPanelScroll();
                }
            };

            var mydropmenu;
            function initDropMenu() {
                mydropmenu = document.createElement( 'div' );
                mydropmenu.className = 'dropmenu dropmenu-hidden';
                mydropmenu.innerHTML = ''
                    + '<div class="menu"></div>'
                    + '<div class="panel">'
                        + '<div id="mypanel" class="ui-tab-panel"></div>'
                    + '</div>';
                wrapper2.appendChild( mydropmenu );
            }

            mytab = null;
            function initDropMenuTab() {
                mytab = new Tab({
                    tabs: tab.get( 'tabs' ).map(function ( item ) {
                        return { title: item.title };
                    }),
                    scroll: true,
                    activeIndex: 2,
                    orientation: 'vertical',
                    plugins: {
                        // 拖动插件配置
                        scroll: {
                            horizontal: false // 禁止横向滚动
                        }
                    }
                });
                mytab.on( 'change', function ( ev, data ) {
                    var panel = tab.get( 'tabs' )[ data.index ].panel;
                    $( '#mypanel' ).innerHTML = $( '#' + panel ).innerHTML;
                    mypanelScroll && mypanelScroll.repaint();
                });
                mytab.on( 'afterdispose', function () {
                    mypanelScroll && mypanelScroll.destroy();
                    mypanelScroll = null;
                });
                mytab.appendTo( mydropmenu.querySelector( '.menu' ) );
                
                mytab.get( 'plugins' )[ 'TabScroll' ].repaint();
            }

            var mypanelScroll;
            function initDropMenuPanelScroll() {
                mypanelScroll = Scroll(
                    $( '#mypanel' ).parentNode,
                    { scrollbar: true }
                );
            }


            // 修复300ms点击延迟
            Tap.mixin( mymenu.get( 'main' ) );

        }
    );

    document.addEventListener( 'touchstart', function(){}, false);
    </script>
</body>
</html>
